<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
<!-- ToDo: get rid of this
     We fail when this isn't present when doing regular builds because we don't set the NuGetTargetMoniker which
     means we don't resolve references... -->
  <!-- Setup properties per TargetGroup -->
  <Choose>

    <When Condition="'$(TargetGroup)'==''">
      <PropertyGroup>
      </PropertyGroup>
    </When>


    <When Condition="'$(TargetGroup)'=='netcore50'">
      <PropertyGroup>
        <PackageTargetFramework>netcore50</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.Private.NetNative</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETCore,Version=v5.0</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netcore50aot'">
      <PropertyGroup>
        <PackageTargetFramework>netcore50</PackageTargetFramework>
        <PackageTargetRuntime>aot</PackageTargetRuntime>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.Private.NetNative</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETCore,Version=v5.0</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.0'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.0</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.0</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.1'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.1</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.2'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.2</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.2</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.3'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.3</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.3</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.4'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.4</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.4</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.5'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.5</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.5</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.6'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.6</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.6</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard1.7'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.7</PackageTargetFramework>
        <NuGetTargetMoniker>.NETStandard,Version=v1.7</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard13aot'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.3</PackageTargetFramework>
        <PackageTargetRuntime>aot</PackageTargetRuntime>
        <NuGetTargetMoniker>.NETStandard,Version=v1.3</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netstandard15aot'">
      <PropertyGroup>
        <PackageTargetFramework>netstandard1.5</PackageTargetFramework>
        <PackageTargetRuntime>aot</PackageTargetRuntime>
        <NuGetTargetMoniker>.NETStandard,Version=v1.5</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netcoreapp1.0'">
      <PropertyGroup>
        <PackageTargetFramework>netcoreapp1.0</PackageTargetFramework>
        <NuGetTargetMoniker>.NETCoreApp,Version=v1.0</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='netcoreapp1.1'">
      <PropertyGroup>
        <PackageTargetFramework>netcoreapp1.1</PackageTargetFramework>
        <NuGetTargetMoniker>.NETCoreApp,Version=v1.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='dnxcore50'">
      <PropertyGroup>
        <ConfigurationErrorMsg>$(ConfigurationErrorMsg);DNXCore50 has been deprecated.  Please use NETStandard1.X or NETCoreApp1.0 instead.</ConfigurationErrorMsg>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='net463'">
      <PropertyGroup>
        <PackageTargetFramework>net463</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6.3</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETFramework,Version=v4.6.3</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='net462'">
      <PropertyGroup>
        <PackageTargetFramework>net462</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6.2</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETFramework,Version=v4.6.2</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='net461'">
      <PropertyGroup>
        <PackageTargetFramework>net461</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6.1</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETFramework,Version=v4.6.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='net46'">
      <PropertyGroup>
        <PackageTargetFramework>net46</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETFramework,Version=v4.6</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='net451'">
      <PropertyGroup>
        <PackageTargetFramework>net451</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.5.1</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETFramework,Version=v4.5.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='net45'">
      <PropertyGroup>
        <PackageTargetFramework>net45</PackageTargetFramework>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.5</TargetingPackNugetPackageId>
        <NuGetTargetMoniker>.NETFramework,Version=v4.5</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='win8'">
      <PropertyGroup>
        <PackageTargetFramework>win8</PackageTargetFramework>
        <NuGetTargetMoniker>Windows,Version=v8.0</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='wpa81'">
      <PropertyGroup>
        <PackageTargetFramework>wpa81</PackageTargetFramework>
        <NuGetTargetMoniker>WindowsPhoneApp,Version=v8.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='uap101aot'">
      <PropertyGroup>
        <PackageTargetFramework>uap10.1</PackageTargetFramework>
        <PackageTargetRuntime>aot</PackageTargetRuntime>
        <NuGetTargetMoniker>UAP,Version=v10.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='uap101'">
      <PropertyGroup>
        <PackageTargetFramework>uap10.1</PackageTargetFramework>
        <NuGetTargetMoniker>UAP,Version=v10.1</NuGetTargetMoniker>
      </PropertyGroup>
    </When>


    <When Condition="'$(TargetGroup)'=='portable-net45+win8+sl5'">
      <PropertyGroup>
        <PackageTargetFramework>portable-net45+win8+sl5</PackageTargetFramework>
        <NuGetTargetMoniker>.NETPortable,Version=v0.0,Profile=Profile47</NuGetTargetMoniker>
      </PropertyGroup>
      <ItemGroup>
        <Compile Include="$(CommonPath)\System\Reflection\AssemblyMetadataAttribute.cs">
          <Link>System\Reflection\AssemblyMetadataAttribute.cs</Link>
        </Compile>
      </ItemGroup>
    </When>
    <When Condition="'$(TargetGroup)'=='portable-net40+sl4+win8+wp8'">
      <PropertyGroup>
        <PackageTargetFramework>portable-net40+sl4+win8+wp8</PackageTargetFramework>
        <NuGetTargetMoniker>.NETPortable,Version=v0.0,Profile=Profile36</NuGetTargetMoniker>
      </PropertyGroup>
      <ItemGroup>
        <Compile Include="$(CommonPath)\System\Reflection\AssemblyMetadataAttribute.cs">
          <Link>System\Reflection\AssemblyMetadataAttribute.cs</Link>
        </Compile>
      </ItemGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <ConfigurationErrorMsg>$(ConfigurationErrorMsg);Unknown TargetGroup [$(TargetGroup)] specificed in your project.</ConfigurationErrorMsg>
      </PropertyGroup>
    </Otherwise>
  </Choose>

  <Target Name="SetTargetGroupProperties"
          BeforeTargets="BeforeResolveReferences"
          Condition="'$(TargetGroup)' != '' and '$(_BuildVertical)' == 'true'">
    <PropertyGroup>
      <PackageTargetFramework Condition="'%(TargetGroups.Identity)' == '$(TargetGroup)' and '%(TargetGroups.PackageTargetFramework)' != ''">%(TargetGroups.PackageTargetFramework)</PackageTargetFramework>
      <PackageTargetRuntime Condition="'%(TargetGroups.Identity)' == '$(TargetGroup)' and '%(TargetGroups.PackageTargetRuntime)' != ''">%(TargetGroups.PackageTargetRuntime)</PackageTargetRuntime>
      <NuGetTargetMoniker Condition="'%(TargetGroups.Identity)' == '$(TargetGroup)' and '%(TargetGroups.NuGetTargetMoniker)' != ''">%(TargetGroups.NuGetTargetMoniker)</NuGetTargetMoniker>
      <TargetingPackNugetPackageId Condition="'%(TargetGroups.Identity)' == '$(TargetGroup)' and '%(TargetGroups.TargetingPackNugetPackageId)' != ''">%(TargetGroups.TargetingPackNugetPackageId)</TargetingPackNugetPackageId>
    </PropertyGroup>
  </Target>
</Project>