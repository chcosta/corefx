<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="12.0" DefaultTargets="Build" TreatAsLocalProperty="BuildProjectReferences" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <!--
        Run PackageTesting against all projects in the Projects folder 
    -->
    <ItemGroup>
        <PackagingProjects Include="$(MSBuildThisFileDirectory)Projects\**\project.json" />
        <ExcludePackagingProjects Include="$(MSBuildThisFileDirectory)Projects\SinglePackageTemplate\project.json" />
    </ItemGroup>
    
    <Target Name="Build">
        <ItemGroup>
            <PackagingProjects Remove="@(ExcludePackagingProjects)" />
        </ItemGroup>
        <MSBuild 
            Projects="$(MSBuildThisFileDirectory)PackageTesting.proj"
            Properties="Project=%(PackagingProjects.Identity);UseCpvsBuild=$(UseCpvsBuild);UseDnx=$(UseDnx)"
            BuildInParallel="true" 
            StopOnFirstFailure="false" />
    </Target>
</Project>
